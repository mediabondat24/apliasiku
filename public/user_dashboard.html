<!DOCTYPE html>
<html lang="en"> <!--begin::Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>BubbleFoto | Dashboar User</title><!--begin::Primary Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="AdminLTE 4 | Fixed Sidebar">
    <meta name="author" content="ColorlibHQ">
    <meta name="description" content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS.">
    <meta name="keywords" content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard"><!--end::Primary Meta Tags--><!--begin::Fonts-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous"><!--end::Fonts--><!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.3.0/styles/overlayscrollbars.min.css" integrity="sha256-dSokZseQNT08wYEWiz5iLI8QPlKxG+TswNRD8k35cpg=" crossorigin="anonymous"><!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.min.css" integrity="sha256-Qsx5lrStHZyR9REqhUF8iQt73X06c8LGIUPzpOhwRrI=" crossorigin="anonymous"><!--end::Third Party Plugin(Bootstrap Icons)--><!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="../app/dist/css/adminlte.css"><!--end::Required Plugin(AdminLTE)-->
    <style>
        /* Styling untuk modal */
        #editModal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 1.25rem;
        }
        .close {
            color: #aaa;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head> <!--end::Head--> <!--begin::Body-->

<body class="layout-fixed sidebar-expand-lg bg-body-tertiary"> <!--begin::App Wrapper-->
    <div class="app-wrapper"> <!--begin::Header-->
        <nav class="app-header navbar navbar-expand bg-body"> <!--begin::Container-->
            <div class="container-fluid"> <!--begin::Start Navbar Links-->
                <ul class="navbar-nav">
                    <li class="nav-item"> <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button"> <i class="bi bi-list"></i> </a> </li>
                    <li class="nav-item d-none d-md-block"> <a href="/user_dashboard.html" class="nav-link">Dashboard</a> </li>
                    
                </ul> <!--end::Start Navbar Links--> <!--begin::End Navbar Links-->
                <ul class="navbar-nav ms-auto"> <!--begin::Navbar Search-->   
                <li class="button"> <a href="/logout" class="btn btn-danger">Logout</a> </li><!--end::User Menu Dropdown-->
                </ul> <!--end::End Navbar Links-->
            </div> <!--end::Container-->
        </nav> <!--end::Header--> <!--begin::Sidebar-->
        <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark"> <!--begin::Sidebar Brand-->
            <div class="sidebar-brand"> <!--begin::Brand Link--> <a href="/user_dashboard.html?id=USER_ID" class="brand-link"> <!--begin::Brand Image--> <img src="../app/dist/assets/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image opacity-75 shadow"> <!--end::Brand Image--> <!--begin::Brand Text--> <span class="brand-text fw-light">Bubble Foto</span> <!--end::Brand Text--> </a> <!--end::Brand Link--> </div> <!--end::Sidebar Brand--> <!--begin::Sidebar Wrapper-->
            <div class="sidebar-wrapper">
                <nav class="mt-2"> <!--begin::Sidebar Menu-->
                    <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
                        
                        <li class="nav-item"> <a href="/user_dashboard.html?id=USER_ID" class="nav-link"> <i class="nav-icon bi bi-palette"></i>
                                <p>Dashboard</p>
                            </a> </li>
                       
                    </ul> <!--end::Sidebar Menu-->
                </nav>
            </div> <!--end::Sidebar Wrapper-->
        </aside> <!--end::Sidebar--> <!--begin::App Main-->
        <main class="app-main"> <!--begin::App Content Header-->
            <!--end::App Content Header--> <!--begin::App Content-->

            <div class="app-content"> <!--begin::Container-->
                <div class="container-fluid"> <!--begin::Row-->
                    <div class="row">
                        <div class="col-12"> <!-- Default box -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Selamat Datang, <span id="username"></span>!</h3>
                                </div>
                                <div class="container mt-5">
                                <div class="table-responsive">
                                    <table class="table table-bordered mt-3">
                                        <thead>
                                            <tr>
                                                
                                                <th>Username TikTok</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                            
                                            <td id="username_tiktok">
                                                <span id="username_tiktok1">Belum terdaftar</span><br> 
                                                <span id="username_tiktok2">Belum terdaftar</span><br> 
                                                <span id="username_tiktok3">Belum terdaftar</span>
                                            </td>

                                            
                                            <td>
                                                <button id="editButton" class="btn btn-primary">Edit</button>
                                                <a id="playButton" class="btn btn-success">Play</a>
                                            </td>
                                        </tr>
                                        </tbody>
        </table>
        <table class="table table-bordered mt-3">
            <thead>
            <tr>
                <th>Status</th>
                <th>Masa Aktif</th>
                <th>Paket</th>
            </tr>
        </thead>
        <tbody>
        <tr>
            <td id="status">-</td>
            <td id="expiration_date">-</td>
            <td id="package_type">-</td>
        </tr>
        </tbody>
        </table>
    </div>
</div>


								 <!-- Pop-up Modal -->
								  <div id="editModal" class="modal">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h2>Edit Akun TikTok</h2>
                                            <span class="close">&times;</span>
                                        </div>
                                        <form id="editForm">
                                            <div class="form-group">
                                                <label for="username_tiktok1">Username TikTok 1:</label>
                                                <input type="text" id="username_tiktok1_input" name="username_tiktok1" class="form-control">
                                            </div>
                                            <div class="form-group">
                                                <label for="username_tiktok2">Username TikTok 2:</label>
                                                <input type="text" id="username_tiktok2_input" name="username_tiktok2" class="form-control">
                                            </div>
                                            <div class="form-group">
                                                <label for="username_tiktok3">Username TikTok 3:</label>
                                                <input type="text" id="username_tiktok3_input" name="username_tiktok3" class="form-control">
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" id="saveButton" class="btn btn-success">Simpan</button>
                                                <button type="button" class="btn btn-secondary" onclick="closeModal()">Batal</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                
<div class="card-footer" style="color: red; font-style: italic;">
    Silahkan Klik tombol Play untuk menuju ke aplikasi Bubble Foto.!
</div>
 <!-- /.card -->
</div>
                    </div> <!--end::Row-->
                </div> <!--end::Container-->
            </div> <!--end::App Content-->
        </main> <!--end::App Main--> <!--begin::Footer-->
        <footer class="app-footer"> <!--begin::To the end-->
            <div class="float-end d-none d-sm-inline">By : Arif</div> <!--end::To the end--> <!--begin::Copyright--> <strong>
                Copyright &copy; 2024&nbsp;
                <a href="https://bubblefoto.online" class="text-decoration-none">Bubble Foto</a>.
            </strong>
            All rights reserved.
            <!--end::Copyright-->
        </footer> <!--end::Footer-->
    </div> <!--end::App Wrapper--> <!--begin::Script--> <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.3.0/browser/overlayscrollbars.browser.es6.min.js" integrity="sha256-H2VM7BKda+v2Z4+DRy69uknwxjyDRhszjXFhsL4gD3w=" crossorigin="anonymous"></script> <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha256-whL0tQWoY1Ku1iskqPFvmZ+CHsvmRWx/PIoEvIeWh4I=" crossorigin="anonymous"></script> <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha256-YMa+wAM6QkVyz999odX7lPRxkoYAan8suedu4k2Zur8=" crossorigin="anonymous"></script> <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script src="../app/dist/js/adminlte.js"></script> <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
    <script>
        const SELECTOR_SIDEBAR_WRAPPER = ".sidebar-wrapper";
        const Default = {
            scrollbarTheme: "os-theme-light",
            scrollbarAutoHide: "leave",
            scrollbarClickScroll: true,
        };
        document.addEventListener("DOMContentLoaded", function() {
            const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
            if (
                sidebarWrapper &&
                typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== "undefined"
            ) {
                OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
                    scrollbars: {
                        theme: Default.scrollbarTheme,
                        autoHide: Default.scrollbarAutoHide,
                        clickScroll: Default.scrollbarClickScroll,
                    },
                });
            }
        });
    </script> <!--end::OverlayScrollbars Configure--> <!--end::Script-->
	<script>
    // Ambil userId dari URL dan cek apakah pengguna sudah login
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('id');

    if (!userId) {
      alert('Anda harus login untuk mengakses halaman ini.');
      window.location.href = '/user_login.html';
    } else {
      // Set href dari tombol Play agar memuat ID pengguna
      document.getElementById('playButton').href = `/bubble.html?id=${userId}`;
    }

    // Fungsi untuk mengambil data profil pengguna dari server
    async function fetchUserProfile() {
    try {
        const response = await fetch(`/user/profile?id=${userId}`);
        if (!response.ok) throw new Error('Gagal mengambil data profil pengguna');
        
        const data = await response.json();
        const expirationDate = new Date(data.expiration_date);
        const formattedExpirationDate = `${expirationDate.getDate().toString().padStart(2, '0')}/${(expirationDate.getMonth() + 1).toString().padStart(2, '0')}/${expirationDate.getFullYear()}`;
        
        // Tampilkan data nama pengguna, status, tipe paket, dan masa aktif
        document.getElementById('username').textContent = data.name;
        document.getElementById('status').textContent = data.status || '-';
        document.getElementById('package_type').textContent = data.package_type || '-';

        // Periksa apakah masa aktif telah habis
        const today = new Date();
        if (expirationDate < today) {
            // Jika masa aktif telah habis, tampilkan teks "Masa aktif habis"
            document.getElementById('expiration_date').textContent = "Masa aktif habis";
            // Sembunyikan tombol "Play"
            document.getElementById('playButton').style.display = 'none';
        } else {
            // Tampilkan tanggal masa aktif jika masih berlaku
            document.getElementById('expiration_date').textContent = formattedExpirationDate;
            // Pastikan tombol "Play" ditampilkan
            document.getElementById('playButton').style.display = 'inline-block';
        }

        // Tampilkan username TikTok sesuai data yang diterima
        document.getElementById('username_tiktok1').textContent = data.username_tiktok1 || '';
        document.getElementById('username_tiktok2').textContent = data.username_tiktok2 || '';
        document.getElementById('username_tiktok3').textContent = data.username_tiktok3 || '';

        // Sembunyikan kolom username TikTok jika tidak ada
        document.getElementById('username_tiktok2').style.display = data.username_tiktok2 ? 'inline' : 'none';
        document.getElementById('username_tiktok3').style.display = data.username_tiktok3 ? 'inline' : 'none';

    } catch (error) {
        console.error(error);
    }
}



    // Panggil fungsi untuk mengambil data profil saat halaman dimuat
    fetchUserProfile();

    // Fungsi untuk menampilkan pop-up modal
function openModal(packageType, data) {
    document.getElementById('editModal').style.display = 'block';

    // Hanya tampilkan input yang sesuai dengan paket pengguna
    if (packageType === 'Silver') {
        document.getElementById('username_tiktok1_input').value = data.username_tiktok1 || '';
        document.getElementById('username_tiktok1_input').style.display = 'block';
        document.getElementById('username_tiktok2_input').style.display = 'none';
        document.getElementById('username_tiktok3_input').style.display = 'none';
    } else if (packageType === 'Gold') {
        document.getElementById('username_tiktok1_input').value = data.username_tiktok1 || '';
        document.getElementById('username_tiktok2_input').value = data.username_tiktok2 || '';
        document.getElementById('username_tiktok1_input').style.display = 'block';
        document.getElementById('username_tiktok2_input').style.display = 'block';
        document.getElementById('username_tiktok3_input').style.display = 'none';
    } else if (packageType === 'Platinum') {
        document.getElementById('username_tiktok1_input').value = data.username_tiktok1 || '';
        document.getElementById('username_tiktok2_input').value = data.username_tiktok2 || '';
        document.getElementById('username_tiktok3_input').value = data.username_tiktok3 || '';
        document.getElementById('username_tiktok1_input').style.display = 'block';
        document.getElementById('username_tiktok2_input').style.display = 'block';
        document.getElementById('username_tiktok3_input').style.display = 'block';
    }
}

// Fungsi untuk menutup pop-up modal
function closeModal() {
    document.getElementById('editModal').style.display = 'none';
}

// Event listener untuk tombol "Edit"
document.getElementById('editButton').addEventListener('click', async () => {
    try {
        const response = await fetch(`/user/profile?id=${userId}`);
        const data = await response.json();
        openModal(data.package_type, data);
    } catch (error) {
        console.error("Gagal mengambil data profil:", error);
    }
});

// Event listener untuk tombol close (X) pada modal
document.querySelector('.close').addEventListener('click', closeModal);

// Menutup modal jika pengguna mengklik di luar modal
window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
};

// Event listener untuk tombol "Simpan" di modal
document.getElementById('saveButton').addEventListener('click', async () => {
    // Ambil nilai input dari modal
    const username_tiktok1 = document.getElementById('username_tiktok1_input').value;
    const username_tiktok2 = document.getElementById('username_tiktok2_input').value;
    const username_tiktok3 = document.getElementById('username_tiktok3_input').value;

    try {
        // Kirim data ke server untuk diperbarui
        const response = await fetch('/user/update-profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ userId, username_tiktok1, username_tiktok2, username_tiktok3 }),
        });

        const result = await response.json();
        console.log("Response dari server:", result);

        if (response.ok) {
            closeModal(); // Tutup modal setelah berhasil menyimpan
            fetchUserProfile(); // Perbarui tampilan dengan data yang baru
            alert('Akun TikTok berhasil diperbarui');
        } else {
            alert('Gagal memperbarui akun TikTok: ' + (result.error || 'Error tidak diketahui'));
        }
    } catch (error) {
        console.error("Error:", error);
        alert('Terjadi kesalahan');
    }
});

async function fetchUserProfile() {
    try {
        const response = await fetch(`/user/profile?id=${userId}`);
        if (!response.ok) throw new Error('Gagal mengambil data profil pengguna');
        
        const data = await response.json();
        console.log("Data pengguna:", data);  // Debug: Lihat data yang diterima dari server

        const expirationDate = new Date(data.expiration_date);
        console.log("Expiration Date dari server:", expirationDate); // Debug: Lihat tanggal masa aktif

        const today = new Date();
        console.log("Tanggal hari ini:", today); // Debug: Lihat tanggal saat ini untuk perbandingan

        // Format tanggal untuk tampilan
        const formattedExpirationDate = `${expirationDate.getDate().toString().padStart(2, '0')}/${(expirationDate.getMonth() + 1).toString().padStart(2, '0')}/${expirationDate.getFullYear()}`;
        
        // Tampilkan data nama pengguna, status, tipe paket, dan masa aktif
        document.getElementById('username').textContent = data.name;
        document.getElementById('status').textContent = data.status || '-';
        document.getElementById('package_type').textContent = data.package_type || '-';

        // Periksa apakah masa aktif telah habis
        if (expirationDate < today) {
            // Jika masa aktif telah habis, tampilkan teks "Masa aktif habis"
            document.getElementById('expiration_date').textContent = "Masa aktif habis";
            // Sembunyikan tombol "Play"
            document.getElementById('playButton').style.display = 'none';
            console.log("Masa aktif habis, tombol Play disembunyikan."); // Debug: Konfirmasi bahwa Play disembunyikan
        } else {
            // Tampilkan tanggal masa aktif jika masih berlaku
            document.getElementById('expiration_date').textContent = formattedExpirationDate;
            // Pastikan tombol "Play" ditampilkan
            document.getElementById('playButton').style.display = 'inline-block';
            console.log("Masa aktif masih berlaku, tombol Play ditampilkan."); // Debug: Konfirmasi bahwa Play ditampilkan
        }

        // Tampilkan username TikTok sesuai data yang diterima
        document.getElementById('username_tiktok1').textContent = data.username_tiktok1 || '';
        document.getElementById('username_tiktok2').textContent = data.username_tiktok2 || '';
        document.getElementById('username_tiktok3').textContent = data.username_tiktok3 || '';

        // Sembunyikan kolom username TikTok jika tidak ada
        document.getElementById('username_tiktok2').style.display = data.username_tiktok2 ? 'inline' : 'none';
        document.getElementById('username_tiktok3').style.display = data.username_tiktok3 ? 'inline' : 'none';

    } catch (error) {
        console.error("Error di fetchUserProfile:", error);
    }
}





</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('message') === 'expired') {
        alert("Masa aktif akun Anda telah habis. Silakan perbarui langganan Anda.");
    }
});

</script>
  <script>
fetch('/user/profile')
    .then(response => {
        if (response.status === 401) {
            alert("Anda harus login untuk mengakses halaman ini.");
            window.location.href = '/user_login.html';
        } else {
            return response.json();
        }
    })
    .then(data => {
        // Tampilkan data profil atau lakukan sesuatu jika pengguna login
        console.log(data);
    })
    .catch(error => console.error('Error:', error));
</script>
</body><!--end::Body-->

</html>